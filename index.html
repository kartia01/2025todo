<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css"
        integrity="sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @font-face {
            font-family: MelonFruits;
            src: url(./font/Melon-Fruit.woff);
        }

        @font-face {
            font-family: 'Juache';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }

        ul,
        li {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        html {
            background: url(./image/wood.jpg) no-repeat center;
            background-size: cover;
            height: 100%;
        }

        body {
            background-color: transparent;
        }

        .container {
            background: url(./image/Frame\ 1.jpg) no-repeat center;
            background-size: cover;
        }

        .inp{
            font-family:Juache, sans-serif;
        }

        .inpBtn {
            font-family: Juache, sans-serif;
        }

        .inpMoBtn {
            display: none;
            font-family: Juache, sans-serif;
        }

        .CancelBtn {
            display: none;
            font-family: Juache, sans-serif;
        }

        h3 {
            font-family: MelonFruits, sans-serif;
            font-size: 60px;
        }

        ul li>div {
            font-family: Juache, sans-serif;
        }

        .delAll {
            font-family: Juache, sans-serif;
        }
    </style>
</head>

<body>
    <div class="container py-3 border border-2 border-black rounded-4 mt-3">
        <h3 class="text-center my-4">TODOLIST</h3>
        <div class="row">
            <div class="col-md-6 offset-md-3 d-flex">
                <input type="hidden" class="numInp" />
                <button class="btn btn-primary inpBtn text-light fs-5" style="width:100px">추가</button>
                <button class="btn btn-success inpMoBtn fs-5" style="width:100px">수정</button>
                <button class="btn btn-warning CancelBtn text-light fs-5" style="width:100px">취소</button>

                <input type="text" placeholder="입력하세요" value="" class="inp form-control ms-2 fs-5" />
            </div>
        </div>
        <div class="row px-3">
            <div class="col-md-6 offset-md-3">
                <ul class="viewList">
                    <li class="d-flex justify-content-between py-3">
                        <div>자바</div>
                        <div class="d-flex gap-3">
                            <i class="fa-solid fa-square-check"></i>
                            <i class="fa-solid fa-pen"></i>
                            <i class="fa-solid fa-trash"></i>
                        </div>
                    </li>
                    <li class="d-flex justify-content-between py-3">
                        <div>자바</div>
                        <div class="d-flex gap-3">
                            <i class="fa-solid fa-square"></i>
                            <i class="fa-solid fa-pen"></i>
                            <i class="fa-solid fa-trash"></i>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row py-3">
            <div class="col-md-6 offset-md-3">
                <div class="btn btn-danger d-block delAll fs-5">전체삭제</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/js/bootstrap.bundle.min.js"
        integrity="sha512-HvOjJrdwNpDbkGJIG2ZNqDlVqMo77qbs4Me4cah0HoDrfhrbA+8SBlZn1KrvAQw7cILLPFJvdwIgphzQmMm+Pw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        /*
        1. 입력, 리스트, 체크, 수정, 삭제, 전체삭제 ->CRUD
        2. 디자인 -> 선택자(dom) 찾기 -> 저장소(설계)/샘플데이터생성 -> for 문
        */

        // let listView = [
        //     {
        //         todo: "자바",
        //         done: false,
        //     },
        //     {
        //         todo: "자바스크립트",
        //         done: false,
        //     },
        //     {
        //         todo: "도커",
        //         done: true,
        //     },
        //     {
        //         todo: "mysql",
        //         done: true,
        //     },
        // ];

        // let listView = [
        //     {
        //         todo: "자바",
        //         done: false,
        //     },
        //     {
        //         todo: "자바스크립트",
        //         done: false,
        //     },
        //     {
        //         todo: "도커",
        //         done: true,
        //     },
        //     {
        //         todo: "mysql",
        //         done: true,
        //     },
        // ];

        let listView = [];

        // dom
        const viewDataElem = document.querySelector(".viewList");
        const inpElem = document.querySelector(".inp"); // value
        const inpNumElem = document.querySelector('.numInp');
        const btnElem = document.querySelector(".inpBtn"); // event
        const btnMoElem = document.querySelector(".inpMoBtn"); // event
        const CancelElem = document.querySelector(".CancelBtn"); // event
        const DelAllElem = document.querySelector('.delAll');

        //create
        btnElem.addEventListener("click", function () {
            if (inpElem.value != '') {
                let value = { todo: inpElem.value, done: false }; // 초기값
                listView.push(value);

                // localStorage update
                let valueData = JSON.stringify(listView);
                // 객체를 json 문자열로 변환하는 내장 함수
                localStorage.setItem("todoData", valueData);
                inpElem.value = ''; // set

                viewData();
            } else {
                alert('오늘의 할 일을 입력하세요');
            }
        });

        // modify
        btnMoElem.addEventListener('click', function () {
            // alert('진짜수정!');
            listView[inpNumElem.value].todo = inpElem.value;

            let valueData = JSON.stringify(listView);
            // 객체를 json 문자열로 변환하는 내장 함수
            localStorage.setItem("todoData", valueData);

            // 1 버튼 입력으로 변경
            btnElem.style.display = 'block';
            btnMoElem.style.display = 'none';
            CancelElem.style.display = 'none';
            inpElem.value = '';
            viewData();
        });

        CancelElem.addEventListener('click', function () {
            btnElem.style.display = 'block';
            btnMoElem.style.display = 'none';
            CancelElem.style.display = 'none';
            inpElem.value = '';
            viewData();
        });

        // // cancel
        // cancelElem.addEventListener('click', function(){
        //     if(inpElem.value == true){
        //         let value = {}
        //     }

        // });

        //function
        // read
        // 여러곳에서 사용하기 위해 배열 -> for문 1~100, "문자" -> 함수 -> Dom:document.querySelector("") -> event("click") -> localStorage
        function viewData() {
            // localStorage
            if (localStorage.length > 0) {
                let localData = localStorage.getItem("todoData");
                listView = JSON.parse(localData);
                // json 문자열을 javascript 객체로 변환하는 내장 함수
            }

            let viewData = '';
            listView.forEach(function (item, i) {
                viewData += `
                <li class="d-flex justify-content-between py-3 border-bottom border-black fs-5">`;

                if (item.done) {
                    viewData += `
                    <div style="text-decoration:line-through solid 3px">${item.todo}</div>
                    <div class="d-flex gap-3">`;
                    let localData = localStorage.getItem("todoData");
                    listView = JSON.parse(localData);
                } else {
                    viewData += `
                    <div>${item.todo}</div>
                    <div class="d-flex gap-3">`;
                };

                // if(item.done == true){
                //     viewData += `
                //     <i class="fa-solid fa-square-check" onclick="noDone(${i})"></i>`;
                // }else {
                //     viewData += `<i class="fa-solid fa-square" onclick="yesDone(${i})"></i>`;
                // }

                // item.done == true , item.done 같음
                if (item.done) {
                    viewData += `
                 <i class="fa-solid fa-square-check" onclick="done(${i})"></i>`;
                } else {
                    viewData += `<i class="fa-solid fa-square" onclick="done(${i})"></i>`;
                }

                if(item.done==false){
                viewData += `                            
                  <i class="fa-solid fa-pen" onclick="modi(${i}, '${listView[i].todo}')"></i>
                  <i class="fa-solid fa-trash" onclick="del(${i})"></i>
                </div>
                </li>`;}else{viewData += `                            
                  <i class="fa-solid fa-pen d-none" onclick="modi(${i}, '${listView[i].todo}')"></i>
                  <i class="fa-solid fa-trash d-none" onclick="del(${i})"></i>
                </div>
                </li>`;

                }
            });
            viewDataElem.innerHTML = viewData;
        }
        viewData();

        // done
        // function yesDone(index) {
        //     console.log(index);
        //     listView[index].done = true;
        //     viewData();
        // }

        // function noDone(index) {
        //     listView[index].done = false;
        //     viewData();
        // }

        function done(index) {
            listView[index].done = !listView[index].done;
            let valueData = JSON.stringify(listView);
            // 객체를 json 문자열로 변환하는 내장 함수
            localStorage.setItem("todoData", valueData);
            viewData();
        }

        function modi(index, todo) {
            // alert('수정' + todo);
            inpElem.value = todo;
            inpNumElem.value = index;
            btnElem.style.display = 'none';
            btnMoElem.style.display = 'block';
            CancelElem.style.display = 'block';
        }

        // 개별 삭제
        function del(num) {
            let valueData = JSON.stringify(listView);
            // 객체를 json 문자열로 변환하는 내장 함수
            localStorage.removeItem("todoData", valueData);
            // alert('삭제');
            listView.splice(num, 1);
            viewData();
        }

        // 전체삭제
        DelAllElem.addEventListener('click', function () {
            let valueData = JSON.stringify(listView);
            localStorage.clear("todoData", valueData);
            listView = [];
            viewData();
        });

        /*
     개선방향
     - done:true 이면 수정, 삭제금지
     - done:true 이면 글자, 글자를 text-decoration:line-through
     - done:false 원상복구
     - 수정시 취소버튼 추가 O
     - done 체크, todo title 수정, todo삭제 ,전체 삭제, localStorage 반영
     */
    </script>
</body>

</html>